#!/usr/bin/env php
<?php

/**
 *
 * CLI tool to test the Companion API
 *
 */

// composer auto loader
require __DIR__ . '/../vendor/autoload.php';

use Companion\CompanionApi;
use Companion\Config\CompanionConfig;

// (optional) set filename for where to save tokens
CompanionConfig::setTokenFilename(CompanionConfig::TOKEN_FILENAME);

// create a new token
$api = new CompanionApi('manual_login');

/*
$loginUrl = $api->Account()->getLoginUrl();
$token    = CompanionConfig::getToken()->token;
echo "Token: {$token} - Login URL: \n\n{$loginUrl}\n\n";
die;
*/

// login with the profiles username+password, this is not stored anywhere
// once this has been done once, you don't need to do it for 24 hours for the same profile
$api->Account()->login('', '');

//
// Get API-ing!
//

// Get a list of characters

echo "Getting a list of characters\n";
foreach ($api->Login()->getCharacters()->accounts[0]->characters as $character) {
    echo "- {$character->cid} :: {$character->name} ({$character->world})\n";
}

// Login with a character, this should return the region
echo "log-in in with a character\n";
$api->Login()->loginCharacter('a4b2ecf9e20837ab_26052');


// Get current logged in character#echo "Confirming logged in character ...\n";
$character = $api->login()->getCharacter()->character;
echo "- Logged in as: {$character->name} ({$character->world}) \n";

// we have to get the character status (something to do with World Visit when its out.)
$api->login()->getCharacterStatus();

/*
print_r(
    $api->market()->getItemMarketListings(3)
);
*/

print_r(CompanionConfig::getToken());

// (optional) save our token
CompanionConfig::saveTokens();
